<svg width="850" height="450" viewBox="0 0 850 450" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000000" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" fill="#ffffff" rx="10"/>

  <!-- Title Section -->
  <rect x="0" y="0" width="850" height="65" rx="10" fill="#f8fafc"/>
  <text x="425" y="40" text-anchor="middle" font-family="sans-serif" font-size="24" font-weight="bold" fill="#1e293b">NRR（净收入留存率）核心计算与拆解</text>

  <!-- Formula Box -->
  <g transform="translate(100, 85)">
    <rect x="0" y="0" width="650" height="60" rx="30" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1.5"/>
    <text x="325" y="37" text-anchor="middle" font-family="serif" font-size="16" font-weight="bold" fill="#334155">
      NRR = (期初 ARR + <tspan fill="#10b981">扩展收入</tspan> - <tspan fill="#ef4444">流失</tspan> - <tspan fill="#f59e0b">降级</tspan>) / 期初 ARR
    </text>
  </g>

  <!-- Waterfall Diagram -->
  <g transform="translate(100, 185)">
    <!-- Initial -->
    <rect x="0" y="80" width="100" height="120" rx="6" fill="#64748b" filter="url(#shadow)"/>
    <text x="50" y="215" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold" fill="#475569">期初: $10M</text>

    <!-- Expansion -->
    <rect x="120" y="20" width="100" height="60" rx="6" fill="#10b981" filter="url(#shadow)"/>
    <path d="M 100,80 Q 110,80 120,50" stroke="#10b981" stroke-width="1.5" fill="none" stroke-dasharray="2,2"/>
    <text x="170" y="10" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold" fill="#059669">+ 扩展: $1.5M</text>

    <!-- Churn -->
    <rect x="240" y="80" width="100" height="40" rx="6" fill="#ef4444" filter="url(#shadow)"/>
    <text x="290" y="70" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold" fill="#dc2626">- 流失: $0.8M</text>

    <!-- Contraction -->
    <rect x="360" y="120" width="100" height="20" rx="6" fill="#f59e0b" filter="url(#shadow)"/>
    <text x="410" y="110" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold" fill="#d97706">- 降级: $0.2M</text>

    <!-- Total Result Bar -->
    <rect x="520" y="74" width="100" height="126" rx="6" fill="#3b82f6" filter="url(#shadow)"/>
    <text x="570" y="215" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold" fill="#1d4ed8">期末: $10.5M</text>
    
    <!-- Threshold Line -->
    <line x1="0" y1="80" x2="620" y2="80" stroke="#94a3b8" stroke-width="1" stroke-dasharray="4,4"/>
  </g>

  <!-- Final outcome (Fixed Overlap) -->
  <g transform="translate(680, 240)">
    <rect x="0" y="0" width="140" height="80" rx="12" fill="#eff6ff" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
    <text x="70" y="30" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="bold" fill="#1e40af">最终 NRR</text>
    <text x="70" y="65" text-anchor="middle" font-family="sans-serif" font-size="28" font-weight="bold" fill="#2563eb">105%</text>
  </g>

  <!-- Insight Capsule -->
  <g transform="translate(100, 390)">
    <rect x="0" y="0" width="650" height="40" rx="20" fill="#f0fdf4" stroke="#bbf7d0" stroke-width="1"/>
    <text x="325" y="25" text-anchor="middle" font-family="sans-serif" font-size="14" fill="#065f46">
      <tspan font-weight="bold">关键洞察：</tspan> 只有当 <tspan fill="#10b981" font-weight="bold">扩展收入</tspan> 大于 <tspan fill="#ef4444" font-weight="bold">流失与降级</tspan> 时，NRR 才会超过 100%。
    </text>
  </g>
</svg>
